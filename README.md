# AI Chat

Это простое веб-приложение для создания персонализированных AI-ассистентов. Пользователь может зарегистрироваться, настроить инструкции для своего чат-бота и получить JS-код для встраивания виджета на любой внешний сайт.

Работоспособная версия доступна по адресу https://ai-chat.sokoloff-rv.ru/ (работает через API OpenAI).



## Функциональность

### 1. Панель управления
* **Аутентификация.** Регистрация, авторизация, восстановление пароля.
* **Управление ботами.** Создание чат-ботов с персональными инструкциями (например, *"Ты — фитнес-тренер"* или *"Ты — консультант по запчастям"*).
* **Генерация кода.** Автоматическое создание HTML-кода для вставки на сайт.

### 2. Встраиваемый виджет
* **Изоляция стилей.** Использует **Shadow DOM**, чтобы стили сайта-родителя не конфликтовали с версткой чата.
* **Малый вес.** Написан на Vue 3, собирается в один JS-бандл.
* **Умная идентификация.** Механизм «ленивой регистрации» отслеживает анонимных посетителей через `localStorage` и сохраняет историю переписки даже после перезагрузки страницы.
* **Адаптивность.** Корректно отображается на мобильных и десктопных устройствах.

### 3. Бэкенд
* **Сохранение истории.** Вся переписка сохраняется в реляционной базе данных MySQL.
* **AI Абстракция.** Реализован паттерн «Strategy». Система может легко переключаться между тестовой заглушкой и реальными API (реализованы: OpenAI, OpenRouter, Google Gemini).
* **Безопасность.** Использование UUID для публичных идентификаторов ботов.



## Структура базы данных

Проект использует 4 основные таблицы:

1.  `users` — Владельцы чат-ботов.
2.  `chats` — Настройки чат-ботов.
3.  `visitors` — Конечные пользователи виджета.
4.  `messages` — Сообщения чат-ботов.

Полная схема базы данных доступна по ссылке https://dbdiagram.io/d/AI-chat-69410788e877c63074fcff30.



## Установка и запуск

### Требования
* PHP 8.2+
* Composer
* Node.js & NPM
* MySQL/PostgreSQL

### Шаги установки

1.  **Клонирование репозитория:**
    ```bash
    git clone git@github.com:sokoloff-rv/ai-chat.git
    ```

2.  **Установка зависимостей:**
    ```bash
    composer install
    npm install
    ```

3.  **Настройка окружения:**
    ```bash
    cp .env.example .env
    php artisan key:generate
    ```
    *После этого настройте подключение к базе данных в файле `.env`.*

4.  **Миграции:**
    ```bash
    php artisan migrate
    ```

5.  **Сборка фронтенда:**
    ```bash
    npm run build
    ```

6.  **Запуск локального сервера (если необходимо):**
    ```bash
    php artisan serve
    ```

7.  **Запуск тестов:**
    ```bash
    php artisan test
    ```

    Для корректного выполнения тестов необходимо предварительно настроить подключение к тестовой базе данных в файле phpunit.xml. 
    
    Пример конфигурации:

    ```text
    <env name="DB_HOST" value="localhost"/>
    <env name="DB_PORT" value="3306"/>
    <env name="DB_DATABASE" value="test_database_name"/>
    <env name="DB_USERNAME" value="user"/>
    <env name="DB_PASSWORD" value="password"/>
    ```
